<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>„Åü„ÅìÁÑº„Åç„Éû„Çπ„Çø„Éº - Takoyaki Master</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Noto+Sans+JP:wght@400;700&display=swap"
        rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans JP', sans-serif;
            background-color: #1a1a2e;
            color: #e0e0e0;
        }

        .pixel-font {
            font-family: 'Press Start 2P', cursive;
        }

        .takoyaki-hole {
            width: 80px;
            height: 80px;
            background: #333;
            border-radius: 50%;
            border: 4px solid #222;
            box-shadow: inset 2px 2px 5px rgba(0, 0, 0, 0.5);
            position: relative;
            cursor: pointer;
            overflow: hidden;
            transition: transform 0.1s;
        }

        .takoyaki-hole:active {
            transform: scale(0.95);
        }

        .batter {
            background: #fdf5e6;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            display: none;
        }

        .octopus {
            width: 30px;
            height: 30px;
            background: #ff4d4d;
            border-radius: 50%;
            position: absolute;
            top: 25px;
            left: 25px;
            display: none;
        }

        .cooked-1 {
            background: #fcebc5;
        }

        .cooked-2 {
            background: #e6cca0;
        }

        .cooked-3 {
            background: #d2691e;
        }

        /* Perfect */
        .burnt {
            background: #3e2723;
        }

        /* Particles */
        @keyframes steam {
            0% {
                transform: translateY(0) scale(1);
                opacity: 0.8;
            }

            100% {
                transform: translateY(-20px) scale(2);
                opacity: 0;
            }
        }

        .steam {
            position: absolute;
            width: 10px;
            height: 10px;
            background: #fff;
            border-radius: 50%;
            animation: steam 1s linear forwards;
            pointer-events: none;
        }
    </style>
</head>

<body class="min-h-screen flex flex-col items-center justify-center p-4">

    <!-- Game HUD -->
    <div class="w-full max-w-2xl mb-8 flex justify-between items-end border-b-2 border-cyan-500 pb-4">
        <div>
            <h1 class="text-2xl md:text-4xl text-cyan-400 pixel-font mb-2">TAKOYAKI MASTER</h1>
            <p class="text-xs text-gray-400">STATUS: <span id="status-text"
                    class="text-yellow-400 font-bold">OPENING</span></p>
        </div>
        <div class="text-right">
            <div class="text-xs text-gray-400 pixel-font">SCORE</div>
            <div id="score" class="text-3xl font-bold text-pink-500 pixel-font">0000</div>
        </div>
    </div>

    <!-- Main Game Area -->
    <div class="bg-gray-800 p-8 rounded-xl shadow-2xl border-4 border-gray-700 relative">
        <!-- Iron Plate -->
        <div class="grid grid-cols-3 md:grid-cols-4 gap-4 bg-gray-900 p-6 rounded-lg shadow-inner">
            <!-- Generated by JS -->
        </div>

        <!-- Controls -->
        <div class="mt-8 flex gap-4 justify-center">
            <button id="tool-batter" onclick="setTool('batter')"
                class="px-6 py-3 bg-yellow-100 text-yellow-900 rounded-full font-bold hover:bg-yellow-200 border-4 border-transparent focus:border-cyan-400 transition-all">
                ü•£ ÁîüÂú∞ (Batter)
            </button>
            <button id="tool-octopus" onclick="setTool('octopus')"
                class="px-6 py-3 bg-red-100 text-red-900 rounded-full font-bold hover:bg-red-200 border-4 border-transparent focus:border-cyan-400 transition-all">
                üêô „Çø„Ç≥ (Tako)
            </button>
            <button id="tool-pick" onclick="setTool('pick')"
                class="px-6 py-3 bg-blue-100 text-blue-900 rounded-full font-bold hover:bg-blue-200 border-4 border-cyan-500 focus:border-cyan-400 transition-all">
                ü•¢ „Éî„ÉÉ„ÇØ (Flip)
            </button>
        </div>
    </div>

    <div class="mt-8 text-center text-gray-500 text-sm">
        <p>1. ÁîüÂú∞„ÇíÊµÅ„Åô -> 2. „Çø„Ç≥„ÇíÂÖ•„Çå„Çã -> 3. Ëâ≤„Åå„Å§„ÅÑ„Åü„Çâ„Å≤„Å£„Åè„ÇäËøî„Åô -> 4. ÂÆåÊàêÔºÅ</p>
    </div>

    <a href="index.html"
        class="mt-8 px-6 py-2 border border-gray-600 text-gray-400 hover:text-white hover:border-white rounded transition-colors pixel-font text-xs">
        < BACK TO MENU </a>

            <script>
                const GRID_SIZE = 12;
                const TAKOYAKI_STATE = {
                    EMPTY: 0,
                    BATTER: 1,
                    HAS_TAKO: 2,
                    COOKING_SIDE1: 3,
                    FLIPPED: 4,
                    COOKING_SIDE2: 5,
                    DONE: 6,
                    BURNT: 7
                };

                let currentTool = 'pick';
                let score = 0;
                let takoyakis = [];

                // Init Grid
                const grid = document.querySelector('.grid');
                for (let i = 0; i < GRID_SIZE; i++) {
                    const hole = document.createElement('div');
                    hole.className = 'takoyaki-hole flex justify-center items-center';
                    hole.innerHTML = '<div class="batter"></div><div class="octopus"></div>';
                    hole.onclick = () => interact(i);
                    grid.appendChild(hole);

                    takoyakis.push({
                        el: hole,
                        batterEl: hole.querySelector('.batter'),
                        takoEl: hole.querySelector('.octopus'),
                        state: TAKOYAKI_STATE.EMPTY,
                        cookLevel: 0,
                        side1Cooked: 0,
                        side2Cooked: 0,
                        isFlipped: false
                    });
                }

                function setTool(tool) {
                    currentTool = tool;
                    document.querySelectorAll('button').forEach(b => b.classList.remove('border-cyan-500'));
                    document.getElementById(`tool-${tool}`).classList.add('border-cyan-500');
                }

                function interact(index) {
                    const t = takoyakis[index];

                    if (currentTool === 'batter' && t.state === TAKOYAKI_STATE.EMPTY) {
                        t.state = TAKOYAKI_STATE.BATTER;
                        t.batterEl.style.display = 'block';
                        playSound('pour');
                    }
                    else if (currentTool === 'octopus' && t.state === TAKOYAKI_STATE.BATTER) {
                        t.state = TAKOYAKI_STATE.HAS_TAKO;
                        t.takoEl.style.display = 'block';
                        // Start cooking
                        t.state = TAKOYAKI_STATE.COOKING_SIDE1;
                        playSound('plop');
                    }
                    else if (currentTool === 'pick') {
                        if (t.state === TAKOYAKI_STATE.COOKING_SIDE1) {
                            // Turn over
                            t.isFlipped = true;
                            t.state = TAKOYAKI_STATE.COOKING_SIDE2;
                            t.batterEl.style.transform = 'rotateX(180deg)';
                            t.takoEl.style.display = 'none'; // Hide tako inside
                            playSound('flip');
                        } else if (t.state === TAKOYAKI_STATE.COOKING_SIDE2 || t.state === TAKOYAKI_STATE.DONE) {
                            // Pick up (Serve)
                            if (t.state === TAKOYAKI_STATE.DONE) {
                                score += 100;
                                showFloatText(t.el, '+100', '#4ade80');
                                playSound('success');
                            } else if (t.state === TAKOYAKI_STATE.BURNT) {
                                score -= 50;
                                showFloatText(t.el, '-50', '#ef4444');
                                playSound('bad');
                            } else {
                                // Too early
                                score -= 10;
                                showFloatText(t.el, 'ÁîüÁÑº„Åë...', '#fbbf24');
                            }
                            resetTakoyaki(t);
                            updateScore();
                        }
                    }
                }

                function resetTakoyaki(t) {
                    t.state = TAKOYAKI_STATE.EMPTY;
                    t.cookLevel = 0;
                    t.side1Cooked = 0;
                    t.side2Cooked = 0;
                    t.isFlipped = false;
                    t.batterEl.style.display = 'none';
                    t.batterEl.style.transform = 'none';
                    t.batterEl.className = 'batter';
                    t.takoEl.style.display = 'none';
                }

                function updateScore() {
                    document.getElementById('score').innerText = String(score).padStart(4, '0');
                }

                function showFloatText(el, text, color) {
                    const float = document.createElement('div');
                    float.innerText = text;
                    float.style.cssText = `position:absolute; color:${color}; font-weight:bold; pointer-events:none; animation: floatUp 1s forwards; z-index:10;`;
                    const rect = el.getBoundingClientRect();
                    float.style.left = (rect.left + 20) + 'px';
                    float.style.top = (rect.top) + 'px';
                    document.body.appendChild(float);
                    setTimeout(() => float.remove(), 1000);
                }

                // Game Loop
                setInterval(() => {
                    takoyakis.forEach(t => {
                        if (t.state === TAKOYAKI_STATE.COOKING_SIDE1) {
                            t.side1Cooked++;
                            renderCooking(t, t.side1Cooked);
                            if (Math.random() > 0.9) createSteam(t.el);
                        } else if (t.state === TAKOYAKI_STATE.COOKING_SIDE2) {
                            t.side2Cooked++;
                            renderCooking(t, t.side2Cooked);
                            if (Math.random() > 0.9) createSteam(t.el);
                        }
                    });
                }, 100);

                function renderCooking(t, cookTime) {
                    // Visual feedback based on cook time
                    if (cookTime > 150) {
                        t.batterEl.className = 'batter burnt';
                        if (t.state !== TAKOYAKI_STATE.BURNT) t.state = TAKOYAKI_STATE.BURNT;
                    } else if (cookTime > 100) {
                        t.batterEl.className = 'batter cooked-3'; // Perfect
                        if (t.isFlipped && t.state !== TAKOYAKI_STATE.DONE) t.state = TAKOYAKI_STATE.DONE;
                    } else if (cookTime > 60) {
                        t.batterEl.className = 'batter cooked-2';
                    } else if (cookTime > 30) {
                        t.batterEl.className = 'batter cooked-1';
                    }
                }

                function createSteam(el) {
                    const steam = document.createElement('div');
                    steam.className = 'steam';
                    steam.style.left = (Math.random() * 40 + 20) + 'px';
                    steam.style.top = '20px';
                    el.appendChild(steam);
                    setTimeout(() => steam.remove(), 1000);
                }

                // Simple Sound Synth
                const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
                function playSound(type) {
                    if (audioCtx.state === 'suspended') audioCtx.resume();
                    const osc = audioCtx.createOscillator();
                    const gain = audioCtx.createGain();
                    osc.connect(gain);
                    gain.connect(audioCtx.destination);

                    const now = audioCtx.currentTime;
                    if (type === 'pour') {
                        osc.type = 'triangle';
                        osc.frequency.setValueAtTime(200, now);
                        osc.frequency.linearRampToValueAtTime(100, now + 0.1);
                    } else if (type === 'plop') {
                        osc.type = 'sine';
                        osc.frequency.setValueAtTime(300, now);
                        osc.frequency.exponentialRampToValueAtTime(50, now + 0.1);
                    } else if (type === 'flip') {
                        osc.type = 'square';
                        osc.frequency.setValueAtTime(150, now);
                        osc.frequency.exponentialRampToValueAtTime(400, now + 0.1);
                    } else if (type === 'success') {
                        osc.type = 'sine';
                        osc.frequency.setValueAtTime(523, now); // C
                        osc.frequency.linearRampToValueAtTime(659, now + 0.1); // E
                        gain.gain.linearRampToValueAtTime(0, now + 0.3);
                        osc.start(); osc.stop(now + 0.3);
                        return;
                    }

                    gain.gain.setValueAtTime(0.1, now);
                    gain.gain.linearRampToValueAtTime(0, now + 0.1);
                    osc.start();
                    osc.stop(now + 0.1);
                }

                // Add Floating CSS animation
                const style = document.createElement('style');
                style.innerHTML = `
        @keyframes floatUp {
            0% { transform: translateY(0); opacity: 1; }
            100% { transform: translateY(-30px); opacity: 0; }
        }`;
                document.head.appendChild(style);

            </script>
</body>

</html>