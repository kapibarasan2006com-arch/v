<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ボール投げゲーム - Ball Toss Challenge</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Noto+Sans+JP:wght@400;900&display=swap"
        rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans JP', sans-serif;
            background-color: #0d0d1a;
            color: #fff;
            overflow: hidden;
            touch-action: none;
        }

        .pixel-font {
            font-family: 'Press Start 2P', cursive;
        }

        #game-area {
            position: relative;
            width: 100vw;
            height: 100vh;
            background: linear-gradient(to bottom, #0f0c29, #302b63, #24243e);
            overflow: hidden;
            cursor: crosshair;
        }

        .target {
            position: absolute;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: 900;
            color: #fff;
            box-shadow: 0 0 15px currentColor;
            animation: pulse 1s infinite alternate;
            user-select: none;
        }

        @keyframes pulse {
            to {
                transform: scale(1.1);
                box-shadow: 0 0 25px currentColor;
            }
        }

        .ball {
            position: absolute;
            width: 30px;
            height: 30px;
            background: #fff;
            border-radius: 50%;
            pointer-events: none;
            box-shadow: 0 0 10px #fff;
        }

        .trajectory-dot {
            position: absolute;
            width: 6px;
            height: 6px;
            background: rgba(255, 255, 255, 0.5);
            border-radius: 50%;
            pointer-events: none;
        }

        #ui-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            padding: 20px;
        }

        .hud-panel {
            pointer-events: auto;
        }
    </style>
</head>

<body>

    <div id="game-area">
        <!-- JS generates content here -->
    </div>

    <div id="ui-layer" class="flex flex-col justify-between">
        <div class="flex justify-between items-start">
            <div class="hud-panel">
                <h1 class="text-xl md:text-2xl text-cyan-400 pixel-font mb-1" style="text-shadow: 2px 2px 0 #000;">BALL
                    TOSS</h1>
                <div class="text-xs text-cyan-200 opacity-80">Drag & Release to Throw</div>
            </div>
            <div class="hud-panel text-right">
                <div class="text-xs text-gray-400 pixel-font mb-1">SCORE</div>
                <div id="score" class="text-3xl font-bold text-yellow-400 pixel-font"
                    style="text-shadow: 2px 2px 0 #000;">0000</div>
                <div class="text-xs text-gray-400 pixel-font mt-2">TIME</div>
                <div id="timer" class="text-xl font-bold text-white pixel-font">60</div>
            </div>
        </div>

        <div class="hud-panel w-full flex justify-center pb-4">
            <a href="index.html"
                class="px-6 py-3 bg-slate-800/80 border border-slate-600 text-slate-300 rounded hover:bg-slate-700 hover:text-white transition pixel-font text-xs">
                EXIT GAME
            </a>
        </div>
    </div>

    <!-- Game Over Modal -->
    <div id="modal" class="fixed inset-0 bg-black/80 flex items-center justify-center hidden z-50">
        <div
            class="bg-slate-900 border-4 border-cyan-500 p-8 rounded-xl text-center max-w-sm w-full mx-4 shadow-[0_0_50px_rgba(6,182,212,0.5)]">
            <h2 class="text-3xl text-yellow-400 pixel-font mb-6">TIME UP!</h2>
            <div class="text-4xl font-black text-white mb-2" id="final-score">0</div>
            <p class="text-gray-400 text-sm mb-8">POINTS</p>
            <button onclick="startGame()"
                class="w-full py-4 bg-cyan-600 hover:bg-cyan-500 text-white font-bold rounded pixel-font transition">
                RETRY
            </button>
        </div>
    </div>

    <script>
        const gameArea = document.getElementById('game-area');
        const scoreEl = document.getElementById('score');
        const timerEl = document.getElementById('timer');
        const modal = document.getElementById('modal');

        let score = 0;
        let timeLeft = 60;
        let gameInterval;
        let spawnInterval;
        let isDragging = false;
        let startX, startY;
        let balls = [];
        let targets = [];
        let isGameActive = false;

        // Constants
        const GRAVITY = 0.5;
        const FRICTION = 0.99;

        // Target Logic
        function createTarget() {
            if (!isGameActive) return;
            const target = document.createElement('div');
            const size = Math.random() * 40 + 40; // 40-80px
            const points = Math.floor(100 - size); // Smaller = more points

            target.className = 'target';
            target.style.width = `${size}px`;
            target.style.height = `${size}px`;
            target.style.left = `${Math.random() * (window.innerWidth - size)}px`;
            target.style.top = `${Math.random() * (window.innerHeight * 0.6) + 50}px`; // Top 60%

            // Random Neon Colors
            const colors = ['#f0f', '#0ff', '#ff0', '#0f0'];
            const color = colors[Math.floor(Math.random() * colors.length)];
            target.style.backgroundColor = `${color}40`; // Transparent bg
            target.style.color = color;
            target.style.border = `2px solid ${color}`;
            target.innerText = points;

            // Movement logic
            let speedX = (Math.random() - 0.5) * 4;
            let speedY = (Math.random() - 0.5) * 4;

            target.dataset.points = points;
            gameArea.appendChild(target);
            targets.push({ el: target, dx: speedX, dy: speedY });

            // Remove after some time
            setTimeout(() => {
                if (target.parentNode) {
                    target.remove();
                    targets = targets.filter(t => t.el !== target);
                }
            }, 5000);
        }

        // Ball Logic
        function throwBall(x, y, vx, vy) {
            const ball = document.createElement('div');
            ball.className = 'ball';
            // Start from bottom center visually if desired, or mouse pos
            // Let's start from dragged start position? Or fixed player pos?
            // "Drag to throw" usually implies drag vector determines velocity. 
            // Let's spawn ball at release point (x,y)
            ball.style.left = `${x - 15}px`;
            ball.style.top = `${y - 15}px`;

            gameArea.appendChild(ball);

            balls.push({
                el: ball,
                x: x, y: y,
                vx: vx, vy: vy,
                active: true
            });
        }

        // Physics Loop
        function update() {
            if (!isGameActive) return;

            // Spawn Targets
            if (Math.random() < 0.03) createTarget();

            // Update Targets
            targets.forEach(t => {
                let rect = t.el.getBoundingClientRect();
                let x = rect.left + t.dx;
                let y = rect.top + t.dy;

                // Bounce off walls
                if (x <= 0 || x + rect.width >= window.innerWidth) t.dx *= -1;
                if (y <= 0 || y + rect.height >= window.innerHeight) t.dy *= -1;

                t.el.style.left = `${x}px`;
                t.el.style.top = `${y}px`;
            });

            // Update Balls
            balls.forEach((b, index) => {
                if (!b.active) return;

                b.x += b.vx;
                b.y += b.vy;
                b.vy += GRAVITY;
                // Air resistance
                b.vx *= FRICTION;
                b.vy *= FRICTION;

                b.el.style.left = `${b.x - 15}px`;
                b.el.style.top = `${b.y - 15}px`;

                // Collision Detection
                targets.forEach((t, tIndex) => {
                    const tRect = t.el.getBoundingClientRect();
                    const bRadius = 15;
                    const tRadius = tRect.width / 2;
                    const tCenterX = tRect.left + tRadius;
                    const tCenterY = tRect.top + tRadius;

                    const dist = Math.hypot(b.x - tCenterX, b.y - tCenterY);

                    if (dist < bRadius + tRadius) {
                        // HIT!
                        score += parseInt(t.el.dataset.points);
                        scoreEl.innerText = score.toString().padStart(4, '0');

                        // Hit Effect
                        createExplosion(tCenterX, tCenterY, t.el.style.color);

                        // Remove Target
                        t.el.remove();
                        targets.splice(tIndex, 1);

                        // Remove Ball? Or bounce? Let's remove for simplicity
                        b.el.remove();
                        b.active = false;
                        balls.splice(index, 1);
                    }
                });

                // Remove if out of bounds
                if (b.y > window.innerHeight + 50) {
                    b.el.remove();
                    b.active = false;
                    balls.splice(index, 1);
                }
            });

            requestAnimationFrame(update);
        }

        function createExplosion(x, y, color) {
            for (let i = 0; i < 8; i++) {
                const p = document.createElement('div');
                p.style.cssText = `position:absolute; width:10px; height:10px; background:${color}; border-radius:50%; left:${x}px; top:${y}px; pointer-events:none; transition: all 0.5s ease-out;`;
                gameArea.appendChild(p);

                setTimeout(() => {
                    const angle = (Math.PI * 2 / 8) * i;
                    const dist = 50;
                    p.style.transform = `translate(${Math.cos(angle) * dist}px, ${Math.sin(angle) * dist}px) scale(0)`;
                    p.style.opacity = 0;
                }, 10);
                setTimeout(() => p.remove(), 500);
            }
        }

        // Input Handling
        gameArea.addEventListener('pointerdown', (e) => {
            if (!isGameActive) return;
            isDragging = true;
            startX = e.clientX;
            startY = e.clientY;

            // Visual indicator
            const dot = document.createElement('div');
            dot.className = 'trajectory-dot';
            dot.id = 'start-dot';
            dot.style.left = `${startX - 3}px`;
            dot.style.top = `${startY - 3}px`;
            gameArea.appendChild(dot);
        });

        gameArea.addEventListener('pointermove', (e) => {
            if (!isDragging || !isGameActive) return;
            // Draw line?
        });

        gameArea.addEventListener('pointerup', (e) => {
            if (!isDragging || !isGameActive) return;
            isDragging = false;
            document.getElementById('start-dot')?.remove();

            const endX = e.clientX;
            const endY = e.clientY;

            // Calculate Vector
            const dx = startX - endX; // Pull back to throw forward? Or Drag direction? 
            // Let's implement "Flick" style: Drag direction = throw direction
            // Wait, standard mobile games: "Pull back (Sling)" or "Flick"
            // Let's do SLINGSHOT: Pull back from start to aim opposite.
            // Vector = Start - End

            const forceMultiplier = 0.15;
            const vx = (startX - endX) * forceMultiplier;
            const vy = (startY - endY) * forceMultiplier;

            // If movement is too small, ignore
            if (Math.hypot(startX - endX, startY - endY) < 10) return;

            throwBall(startX, startY, vx, vy);
        });

        // Game State
        function startGame() {
            modal.classList.add('hidden');
            score = 0;
            timeLeft = 60;
            scoreEl.innerText = "0000";
            timerEl.innerText = timeLeft;
            balls.forEach(b => b.el.remove());
            targets.forEach(t => t.el.remove());
            balls = [];
            targets = [];
            isGameActive = true;

            gameInterval = setInterval(() => {
                timeLeft--;
                timerEl.innerText = timeLeft;
                if (timeLeft <= 0) gameOver();
            }, 1000);

            requestAnimationFrame(update);
        }

        function gameOver() {
            isGameActive = false;
            clearInterval(gameInterval);
            document.getElementById('final-score').innerText = score;
            modal.classList.remove('hidden');
        }

        // Auto Start
        startGame();

    </script>
</body>

</html>